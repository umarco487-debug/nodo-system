<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Innovatec NODO PRO</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>

body{
font-family:Arial;
margin:0;
color:white;
background:url("fondo.jpg");
background-size:cover;
background-position:center;
}

header{
background:rgba(0,0,0,0.6);
padding:20px;
text-align:center;
}

.container{
padding:30px;
background:rgba(15,23,42,0.85);
min-height:100vh;
}

input{
padding:10px;
margin:5px;
width:260px;
border-radius:6px;
border:none;
}

button{
padding:10px 15px;
background:#38bdf8;
border:none;
cursor:pointer;
font-weight:bold;
border-radius:6px;
}

.card{
background:#1e293b;
padding:20px;
margin-top:20px;
border-radius:12px;
width:300px;
}

.hidden{
display:none;
}

</style>
</head>

<body>

<header>
<h1>Innovatec</h1>
<p>Sistema NODO TECNM PRO</p>
</header>

<div class="container">

<h2>Registro Usuario</h2>

<input id="nombre" placeholder="Nombre"><br>
<input id="control" placeholder="UID TARJETA"><br>
<input id="carrera" placeholder="Carrera"><br>

<button onclick="registrar()">Crear Credencial</button>

<div id="tarjeta" class="card hidden">
<h3>Credencial Digital</h3>
<p id="info"></p>
<div id="qrcode"></div>
</div>

</div>

<script>

// ðŸ”¥ AUTO DETECTA TARJETA DESDE ESP32
setInterval(()=>{

fetch("/lastuid")
.then(r=>r.text())
.then(uid=>{

if(uid!="" && uid!="null"){
document.getElementById("control").value = uid;
}

});

},1200);


// ðŸ”¥ CREAR CREDENCIAL
function registrar(){

let nombre=document.getElementById("nombre").value;
let control=document.getElementById("control").value;
let carrera=document.getElementById("carrera").value;

if(nombre==""||control==""||carrera==""){
alert("Completa todo");
return;
}

let link="https://innovatec-debug.github.io/rfid-innovatecc/?user="+control;

document.getElementById("info").innerHTML=
"Nombre: "+nombre+"<br>"+
"UID: "+control+"<br>"+
"Carrera: "+carrera;

document.getElementById("tarjeta").classList.remove("hidden");

document.getElementById("qrcode").innerHTML="";
new QRCode(document.getElementById("qrcode"),link);

}

</script>

</body>
</html>
