#include <WiFi.h>
#include <HTTPClient.h>
#include <SPI.h>
#include <MFRC522.h>

#define SS_PIN 5
#define RST_PIN 22
#define LED_VERDE 27

const char* ssid = "TU_WIFI";
const char* password = "TU_PASS";

// ðŸ”¥ TU PAGINA
String server = "https://innovatec-debug.github.io/rfid-innovatecc/?uid=";

MFRC522 rfid(SS_PIN, RST_PIN);

void setup(){

Serial.begin(115200);

WiFi.begin(ssid,password);

while(WiFi.status()!=WL_CONNECTED){
delay(500);
Serial.print(".");
}

Serial.println("WiFi conectado");

SPI.begin();
rfid.PCD_Init();

pinMode(LED_VERDE,OUTPUT);
}

void loop(){

if(!rfid.PICC_IsNewCardPresent()) return;
if(!rfid.PICC_ReadCardSerial()) return;

String uid="";

for(byte i=0;i<rfid.uid.size;i++){
uid += String(rfid.uid.uidByte[i],HEX);
if(i<rfid.uid.size-1) uid += "-";
}

Serial.println("UID detectado: "+uid);

// prender LED
digitalWrite(LED_VERDE,HIGH);
delay(1000);
digitalWrite(LED_VERDE,LOW);

// ðŸ”¥ enviar UID a pagina
if(WiFi.status()==WL_CONNECTED){

HTTPClient http;

String url = server + uid;

http.begin(url);
int httpCode = http.GET();

Serial.println("Enviado a web");
Serial.println(httpCode);

http.end();
}

rfid.PICC_HaltA();
}
